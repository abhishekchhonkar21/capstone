<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>SmartBin</title>
    <link rel="stylesheet" href="userStyle.css" />
    <script src="https://kit.fontawesome.com/40f7982ca7.js" crossorigin="anonymous"></script>
    <link rel="icon" href="smartbinrednobg.png" type="image/x-icon" />
  </head>
  <body>
    <div id="header">
      <div class="container">
        <nav>
          <img src="smartbinrednobg.png" class="logo" />
          <ul id="sidemenu">
            <li><a href="#header">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="about_form.html">Product & Services</a></li>
            <li><a href="#portfolio">Gallery</a></li>
            <li><a href="#contact">Contact</a></li>
            <li><a href="">Staff Login</a></li>
            <i class="fa-solid fa-xmark" onclick="closemenu()"></i>
          </ul>
          <i class="fa-solid fa-ellipsis-vertical" onclick="openmenu()"></i>
        </nav>
        <div class="header-text">
          <p>Thapar University</p>
          <h1>Hi, I'm the <span>Smart Bin</span> <br />project</h1>
        </div>
      </div>
    </div>

    <!-- About section -->
    <div id="about">
      <div class="container">
        <div class="row">
          <div class="about-col-1">
            <img src="thapar.jpeg" />
          </div>
          <div class="about-col-2">
            <h1 class="sub-title">About Us</h1>
            <p>
              Welcome to SmartBin Solutions, where technology meets community
              action for a cleaner future. At SmartBin, we're dedicated to
              transforming waste management into a collaborative effort. Our
              platform empowers communities and businesses to track and manage
              every bin in real-time, enabling efficient waste collection and
              contributing to a cleaner, healthier environment. Join us as we
              redefine waste management. Together, let's take the first step
              towards a greener future.
            </p>
            <div class="tab-titles">
              <p class="tab-links active-link" onclick="opentab('skills')">
                Targets
              </p>
              <p class="tab-links" onclick="opentab('experience')">
                Achievements
              </p>
              <p class="tab-links" onclick="opentab('education')">
                How can you help!
              </p>
            </div>
            <div class="tab-contents active-tab" id="skills">
              <ul>
                <li>
                  <span>Clean campus <br /></span>creating a safe environment
                </li>
                <li>
                  <span>Easy management <br /></span>increasing management
                  efficiency
                </li>
                <li>
                  <span>Creating awareness <br /></span> education about waste
                  disposal
                </li>
              </ul>
            </div>
            <div class="tab-contents" id="education">
              <ul>
                <li><span>.......<br /></span>----</li>
                <li><span>......<br /></span>------</li>
                <li><span>......<br /></span>------</li>
              </ul>
            </div>
            <div class="tab-contents" id="experience">
              <ul>
                <li><span>.......<br /></span>/////</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Locations -->
    <div id="services">
      <div class="container">
        <h1>Smart Bin locations</h1>
        <div class="services-list">
          <div class="loc1">
            <h2>COS</h2>
            <h3>location 1</h3>
            <h3>location 2</h3>
            <h3>location 3</h3>
          </div>
          <div class="loc2">
            <h2>Jaggi</h2>
            <h3>location 1</h3>
            <h3>location 2</h3>
            <h3>location 3</h3>
          </div>
          <div class="loc3">
            <h2>CSED Block</h3>
            <h3>location 1</h3>
            <h3>location 2</h3>
            <h3>location 3</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio -->
    <div id="portfolio">
      <div class="container">
        <h1 class="sub-title">Gallery</h1>
        <div class="work-list">
          <div class="work">
            <img
              src="gallery1.jpeg"
              alt="coming soon"
              style="background-color: gray"
            />
          </div>
          <div class="work">
            <img src="tietpic.png" alt="coming soon" style="background-color: gray" />
          </div>
          <div class="work">
            <img src="Bblock.jpg" alt="coming soon" style="background-color: gray" />
          </div>
        </div>
      </div>
    </div>

    <!-- Contact section with modified form -->
    <div id="contact">
      <div class="container">
        <div class="row">
          <div class="contact-left">
            <h1 class="sub-title">Contact for Query</h1>
            <p><i class="fa-solid fa-envelope"></i> xyz@gmail.com</p>
            <p><i class="fa-solid fa-phone"></i> 7568275554</p>
          </div>

          <div class="contact-right">
            <h2 style="text-align: center;">Waste Report Form</h2>
            <form id="wasteReportForm">
              <input
                type="text"
                id="firstName"
                name="firstName"
                placeholder="First Name"
                required
              />
              <input
                type="text"
                id="lastName"
                name="lastName"
                placeholder="Last Name"
                required
              />
              <input
                type="email"
                id="email"
                name="email"
                placeholder="Email"
                required
              />
              <input
                type="tel"
                id="contactNumber"
                name="contactNumber"
                placeholder="Contact Number"
                required
              />
              <select id="wasteType" name="wasteType" required>
                <option value="">Select type of waste</option>
                <option value="Corpses Waste">Corpses Waste</option>
                <option value="Plant Waste">Plant Waste</option>
                <option value="Animal Waste">Animal Waste</option>
                <option value="Other">Other</option>
              </select>

              <div style="display: flex; align-items: center;">
                <input
                  type="file"
                  id="picture"
                  name="picture"
                  accept="image/*"
                  style="display: none;"
                />
                <label for="picture" class="btn btn2">Upload Picture</label>
                <span id="file-chosen">No file selected</span>
              </div>

              <img
                id="image-preview"
                src=""
                alt="Image preview"
                style="display: none; max-width: 100%; margin-top: 10px;"
              />

              <div style="margin-top: 15px;">
                
                <button
                  type="button"
                  id="locationButton"
                  class="btn btn2"
                  
                >
                Share Current Location
                </button>
                
              </div>
              <p id="location-status">Location not shared</p>
              <input type="hidden" id="latitude" name="latitude" />
              <input type="hidden" id="longitude" name="longitude" />
              
              <button type="submit" class="btn btn2">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-storage-compat.js"></script>

    <script>
      // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCIJRfgkC0lbIpcaFFahZWNK4Bc7jM_d6s",
      authDomain: "smartbinform.firebaseapp.com",
      databaseURL: "https://smartbinform-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "smartbinform",
      storageBucket: "smartbinform.appspot.com",
      messagingSenderId: "345224231908",
      appId: "1:345224231908:web:45ef4c9fefd13d53c5e5f1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    // Form submission handler
    document.getElementById('wasteReportForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        contactNumber: document.getElementById('contactNumber').value,
        wasteType: document.getElementById('wasteType').value,
        latitude: document.getElementById('latitude').value,
        longitude: document.getElementById('longitude').value,
        timestamp: new Date().toISOString(),
      };

      const file = document.getElementById('picture').files[0];

      if (file) {
        // Create a reference to the location where we want to store the file
        const storageRef = storage.ref('waste_images/' + file.name);

        // Upload the file
        storageRef.put(file).then((snapshot) => {
          console.log('Uploaded a file!');
          // Get the download URL
          return snapshot.ref.getDownloadURL();
        }).then((downloadURL) => {
          console.log('File available at', downloadURL);
          // Add the download URL to the form data
          formData.imageUrl = downloadURL;

          // Now push the data to the Realtime Database
          return database.ref('wasteReports').push(formData);
        }).then(() => {
          alert('Form submitted successfully!');
          resetForm();
        }).catch((error) => {
          console.error('Error submitting form: ', error);
          alert('An error occurred. Please try again.');
        });
      } else {
        // If no file was selected, just push the form data
        database.ref('wasteReports').push(formData)
          .then(() => {
            alert('Form submitted successfully!');
            resetForm();
          })
          .catch((error) => {
            console.error('Error submitting form: ', error);
            alert('An error occurred. Please try again.');
          });
      }
    });

    function resetForm() {
      document.getElementById('wasteReportForm').reset();
      document.getElementById('file-chosen').textContent = 'No file selected';
      document.getElementById('image-preview').style.display = 'none';
      document.getElementById('location-status').textContent = 'Location not shared';
    }

    // Location handling
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('locationButton').addEventListener('click', getLocation);
    });

    function getLocation() {
      document.getElementById('location-status').textContent = 'Requesting location...';
      
      if (!navigator.geolocation) {
        document.getElementById('location-status').textContent = 'Geolocation is not supported by this browser.';
        return;
      }
      
      navigator.geolocation.getCurrentPosition(showPosition, showError, {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 0
      });
    }

    function showPosition(position) {
      document.getElementById('latitude').value = position.coords.latitude;
      document.getElementById('longitude').value = position.coords.longitude;
      document.getElementById('location-status').textContent = 'Location shared successfully: ' + 
        position.coords.latitude.toFixed(6) + ', ' + position.coords.longitude.toFixed(6);
    }

    function showError(error) {
      console.error('Geolocation error:', error);
      switch(error.code) {
        case error.PERMISSION_DENIED:
          document.getElementById('location-status').textContent = "User denied the request for Geolocation.";
          break;
        case error.POSITION_UNAVAILABLE:
          document.getElementById('location-status').textContent = "Location information is unavailable. Please check your device settings.";
          break;
        case error.TIMEOUT:
          document.getElementById('location-status').textContent = "The request to get user location timed out. Please try again.";
          break;
        case error.UNKNOWN_ERROR:
          document.getElementById('location-status').textContent = "An unknown error occurred. Please try again.";
          break;
      }
    }

    // File input handling
    const fileInput = document.getElementById('picture');
    const fileChosen = document.getElementById('file-chosen');
    const imagePreview = document.getElementById('image-preview');
    
    fileInput.addEventListener('change', function () {
      if (this.files && this.files[0]) {
        fileChosen.textContent = this.files[0].name;
        const reader = new FileReader();
        reader.onload = function (e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(this.files[0]);
      } else {
        fileChosen.textContent = 'No file selected';
        imagePreview.style.display = 'none';
      }
    });

    // Side menu functionality
    var sideM = document.getElementById("sidemenu");
    function openmenu() {
      sideM.style.right = "0";
    }
    function closemenu() {
      sideM.style.right = "-200px";
    }
    </script>
  </body>
</html>
