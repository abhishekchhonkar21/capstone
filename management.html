<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="shortcut icon" type="image/png" href="icon.png" />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,500,600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="management_style.css" />
    <title>SmartBin</title>
  </head>
  <body>
    <!-- TOP NAVIGATION -->
    <nav class="smartbin-nav">
      <p class="welcome">Smart<span class="bin">Bin</span> Management System</p>
      <!-- <img src="logo.png" alt="Logo" class="logo" /> -->
    </nav>
    <h1 class="account-info"></h1>
    <main class="app">
      <!-- BALANCE -->

      <div class="balance">
        <div>
          <p class="balance__label">Total weight collected</p>
          <p class="balance__date">
            As of <span class="date">05/03/2037</span>
          </p>
        </div>
        <p class="balance__value">0000</p>
      </div>

      <!-- MOVEMENTS -->
      <div class="movements">
        <!-- Movements rows will be dynamically added here -->
      </div>

      <!-- OPERATION: TRANSFERS -->
      <div class="operation operation--transfer">
        <h2>Add weight</h2>
        <form class="form form--transfer">
          <input type="number" class="form__input form__input--amount" />
          <button class="form__btn form__btn--transfer">&rarr;</button>
          <label class="form__label">Weight</label>
        </form>
      </div>

      <!-- LOGOUT TIMER -->
      <!-- <p class="logout-timer">
        You will be logged out in <span class="timer">05:00</span>
      </p> -->
    </main>

    <script>
      // Data
      const accounts = {
        D1: {
          owner: "D1",
          movements: [], // Empty array to store weight objects
          pin: 5207,
          movementsDates: [], // Empty array to store dates
        },
        D2: {
          owner: "D2",
          movements: [],
          pin: 2222,
          movementsDates: [],
        },
        D3: {
          owner: "D3",
          movements: [],
          pin: 3333,
          movementsDates: [],
        },
        D4: {
          owner: "D4",
          movements: [],
          pin: 4444,
          movementsDates: [],
        },
      };

      // Elements
      const labelWeight = document.querySelector(".balance__value");
      const containerMovements = document.querySelector(".movements");
      const accountInfo = document.querySelector(".account-info");

      // Function to input weight
      function inputWeight(account, weight) {
        const currentDate = new Date();
        const formattedDate = `${currentDate.getDate()}/${
          currentDate.getMonth() + 1
        }/${currentDate.getFullYear()}`;

        // Create object with weight and date
        const newMovement = {
          weight: weight,
          date: formattedDate,
        };

        // Add newMovement to movements and movementsDates arrays
        account.movements.push(newMovement);
        account.movementsDates.push(formattedDate);

        // Store updated account data in local storage
        localStorage.setItem(account.owner, JSON.stringify(account));

        // Display movements and update balance
        displayMovements(account);
        updateTotalWeight(); // Call updateTotalWeight after adding weight
      }

      // Function to display movements
      function displayMovements(account) {
        containerMovements.innerHTML = "";
        account.movements.forEach((movement, index) => {
          const movementType = "Collected";
          const date = movement.date;
          const displayDate = `${date}`; // You can format the date here
          const html = `
                <div class="movements__row">
                    <div class="movements__type movements__type--${movementType}">${
            index + 1
          } ${movementType}</div>
                    <div class="movements__date">${displayDate}</div>
                    <div class="movements__value">${movement.weight}Kg</div>
                </div>
                `;
          containerMovements.insertAdjacentHTML("beforeend", html);
        });
      }

      // Function to update total weight
      function updateTotalWeight() {
        const account = getCurrentAccount();
        const totalWeight = account.movements.reduce((sum, movement) => {
          return sum + movement.weight;
        }, 0);
        labelWeight.textContent = `${totalWeight}Kg`;
      }

      // Function to get the currently selected account
      function getCurrentAccount() {
        const urlParams = new URLSearchParams(window.location.search);
        const accountId = urlParams.get("account");
        const accountData = localStorage.getItem(accountId);
        return JSON.parse(accountData) || accounts[accountId];
      }

      // Event listener for Add Weight button
      const btnAddWeight = document.querySelector(".form__btn--transfer");

      btnAddWeight.addEventListener("click", function (event) {
        event.preventDefault();
        const amount = parseFloat(
          document.querySelector(".form__input--amount").value
        );
        const currentAccount = getCurrentAccount();
        inputWeight(currentAccount, amount);
      });

      // Retrieve and display the selected account data
      const selectedAccount = getCurrentAccount();
      if (selectedAccount) {
        displayMovements(selectedAccount);
        updateTotalWeight();
        accountInfo.textContent = `SmartBin ID - ${selectedAccount.owner}`; // Display account info in navbar
      } else {
        console.log("No account selected.");
      }
    </script>
  </body>
</html>
